<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ sample }}</title>

    <script>
        document.documentElement.setAttribute('data-bs-theme', (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'))
    </script>

    <!-- dotplot requirements-->
    <script src="https://biowasm.com/cdn/v3/aioli.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js" charset="utf-8"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
            integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
            crossorigin="anonymous"></script>

    <link href="../assemblies.css" rel="stylesheet">
    <script type="module" src="../assemblies.js"></script>
    <!--    <script type="module" crossorigin src="../dotplot.js"></script>-->
</head>

<body>

<div class="container text-center">

    <h1>{{ sample }}</h1>

    {% if messages %} {% for message in messages %}
    <div class="alert alert-{{ message.severity }}" role="alert">
        {{ message }}
    </div>
    {% endfor %} {% endif %}

    <h2>ANI matrix</h2>

    <div id="ani-clustermap-container">
        {{ani_html|safe}}
    </div>

</div>

<table class="table table-striped table-bordered">
    <thead>
    <tr>
        <th>Assembler</th>
        {% for assembly in assemblies %}
        <th scope="col">{{ assembly.assembler }}</th>
        {% endfor %}
    </tr>
    </thead>
    <tbody class="table-group-divider">
    <tr>
        <th scope="row">Length</th>
        {% for assembly in assemblies %}
        <td>{{ assembly.__len__() }}bp</td>
        {% endfor %}
    </tr>
    <tr>
        <th scope="row">Length (human)</th>
        {% for assembly in assemblies %}
        <td>{{ assembly.len_human() }}</td>
        {% endfor %}
    </tr>
    <tr>
        <th scope="row">Number of contigs</th>
        {% for assembly in assemblies %}
        <td>{{ assembly.contig_groups.__len__() }}</td>
        {% endfor %}
    </tr>
    <tr>
        <th scope="row">GC content</th>
        {% for assembly in assemblies %}
        <td>{{ (assembly.gc_content() * 100)|round(2) }}%</td>
        {% endfor %}
    </tr>

    <tr>
        <th scope="row">Contigs</th>
        {% for assembly in assemblies %}
        <td>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="cg-all-{{ assembly.assembler }}"
                       onclick="toggleAllContigGroups('{{ assembly.assembler }}')">
                <label class="form-check-label" for="cg-all-{{ assembly.assembler }}">
                    Select all
                </label>
            </div>

            <div class="assembly" data-assembly="{{ assembly.assembler }}">
                {% for contig_group in assembly.contig_groups %}
                {% if contig_group.contigs.__len__() == 1 %}
                {% for contig in contig_group.contigs %}
                <div class="contig-group btn btn-primary position-relative"
                     data-cg="{{ contig_group.id }}" onclick="toggleContigGroup('{{ contig_group.id }}')">
                    {{ contig.original_id }} ({{ contig.len_human() }})
                    <span class="position-absolute top-0 start-100 translate-middle-custom">
                        <div class="d-flex">
                          {{ contig.topology_badge|safe }}
                          {% if contig.has_coverage %}{{ contig.coverage_badge|safe }}{% endif %}
                        </div>
                      </span>
                </div>
                {% endfor %}
                {% else %}
                <div class="contig-group card" data-cg="{{ contig_group.id }}"
                     onclick="toggleContigGroup('{{ contig_group.id }}')"
                     style="width: 18rem;">
                    <div class="card-header">
                        Group: {{ contig_group.id }} ({{contig_group.len_human()}})
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            {% for contig in contig_group.contigs %}
                            <div class="btn btn-primary position-relative">
                                {{ contig.original_id }} ({{ contig.len_human() }})
                                <span class="position-absolute top-0 start-100 translate-middle-custom">
                                    <div class="d-flex">
                                      {{ contig.topology_badge|safe }}
                                      {% if contig.has_coverage %}{{ contig.coverage_badge|safe }}{% endif %}
                                    </div>
                                  </span>
                            </div>
                            {% endfor %}
                        </li>
                    </ul>
                    {% endif %}

                </div>
            </div>

            {% endfor %}
        </td>
        {% endfor %}
    </tr>
    <tr>

    <tr>
        <style>
            .gfaviz-container svg text {
                stroke-width: 1px;
                stroke: white;
                fill: black;
                paint-order: stroke;
                font-weight: 800;
            }

            .gfaviz-container svg text.selected {
                stroke: red;
            }
        </style>
        <th scope="row">Plot</th>
        {% for assembly in assemblies %}
        <!--        <td><img src="{{ assembly.assembly_dir }}/{{ assembly.plot }}" alt="GC content plot"></td>-->
        <td>
            <div class="gfaviz-container" data-assembly="{{ assembly.assembler }}">{{ assembly.plot_svg()|safe }}</div>
        </td>
        {% endfor %}
    </tr>

</table>
</body>
</html>